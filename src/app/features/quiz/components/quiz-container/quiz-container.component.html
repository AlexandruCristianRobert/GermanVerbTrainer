<div class="min-h-screen bg-dark-900 py-4 px-4">
  <div class="max-w-3xl mx-auto animate-fade-in">
    <!-- Header with Timer and Progress -->
    <div
      class="bg-dark-800/80 backdrop-blur-lg shadow-card-dark rounded-lg border border-dark-600/50 p-4 mb-3"
    >
      <div class="flex items-center justify-between mb-3">
        <div>
          <h1 class="text-lg font-bold text-white">Quiz</h1>
          <p class="text-xs text-gray-400">
            {{ currentQuestionIndex + 1 }}/{{ questions.length }}
          </p>
        </div>
        <div class="text-right">
          <div class="text-xl font-bold text-accent-cyan">
            {{ getFormattedTime() }}
          </div>
          <div class="text-xs text-gray-500">Elapsed</div>
        </div>
      </div>

      <!-- Progress Bar -->
      <div class="w-full bg-dark-700 rounded-full h-2 overflow-hidden">
        <div
          class="bg-gradient-to-r from-accent-cyan to-accent-purple h-2 rounded-full transition-all duration-300"
          [style.width.%]="progress"
        ></div>
      </div>
      <div class="flex justify-between text-xs text-gray-500 mt-1.5">
        <span>{{ questionsAnswered }} done</span>
        <span>{{ questionsRemaining }} left</span>
      </div>
    </div>

    <!-- Question Card -->
    <div
      *ngIf="currentQuestion"
      class="bg-dark-800/80 backdrop-blur-lg shadow-card-dark rounded-lg border border-dark-600/50 p-4 mb-3"
    >
      <!-- Question Header -->
      <div class="mb-3">
        <div class="flex items-center flex-wrap gap-2 mb-2.5">
          <span
            class="inline-block px-2 py-1 bg-accent-purple/20 text-accent-purple text-xs font-semibold rounded border border-accent-purple/50"
          >
            {{ currentQuestion.tense }}
          </span>
          <span
            class="inline-block px-2 py-1 bg-success-500/20 text-success-400 text-xs font-semibold rounded border border-success-500/50"
          >
            {{ currentQuestion.verb.verb_type }}
          </span>
          <span
            class="inline-block px-2 py-1 bg-warning-500/20 text-warning-400 text-xs font-semibold rounded border border-warning-500/50"
          >
            Lv{{ currentQuestion.verb.difficulty_level }}
          </span>
        </div>

        <!-- Question Text -->
        <h2 class="text-lg font-bold text-white mb-2">
          {{ currentQuestion.questionText }}
        </h2>

        <p class="text-sm text-gray-400">
          <span class="font-semibold text-accent-cyan">{{
            currentQuestion.verb.infinitive
          }}</span>
          ({{ currentQuestion.verb.english_translation }})
        </p>
      </div>

      <!-- Answer Input -->
      <div class="mb-3">
        <label class="block text-xs font-medium text-gray-300 mb-1.5">
          Your Answer:
        </label>
        <input
          type="text"
          [(ngModel)]="currentAnswer"
          (keypress)="handleKeyPress($event)"
          (input)="showValidation = false"
          placeholder="Type verb..."
          class="w-full px-3 py-2 text-base bg-dark-700 border border-dark-600 rounded text-white placeholder-gray-500 focus:border-accent-cyan focus:ring-1 focus:ring-accent-cyan/30 transition-all duration-300"
          [class.border-error-500]="showValidation && !isCurrentAnswerCorrect()"
          [class.border-success-500]="
            showValidation && isCurrentAnswerCorrect()
          "
          autofocus
        />

        <!-- Validation Feedback -->
        <div *ngIf="showValidation" class="mt-2">
          <div
            *ngIf="isCurrentAnswerCorrect()"
            class="flex items-center text-success-400 text-xs font-medium"
          >
            <svg class="w-4 h-4 mr-1.5" fill="currentColor" viewBox="0 0 20 20">
              <path
                fill-rule="evenodd"
                d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z"
                clip-rule="evenodd"
              />
            </svg>
            Correct!
          </div>
          <div
            *ngIf="!isCurrentAnswerCorrect() && answerError"
            class="flex items-start text-error-400 text-xs font-medium"
          >
            <svg
              class="w-4 h-4 mr-1.5 mt-0.5 flex-shrink-0"
              fill="currentColor"
              viewBox="0 0 20 20"
            >
              <path
                fill-rule="evenodd"
                d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z"
                clip-rule="evenodd"
              />
            </svg>
            {{ answerError }}
          </div>
        </div>
      </div>

      <!-- Action Buttons -->
      <div class="flex gap-2 mb-3">
        <button
          (click)="checkAnswer()"
          [disabled]="!currentAnswer.trim()"
          class="flex-1 bg-gradient-to-r from-accent-cyan to-accent-purple text-white px-4 py-2 rounded font-semibold hover:shadow-glow-cyan disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-300 text-sm"
        >
          Check
        </button>
        <button
          (click)="toggleHint()"
          class="bg-warning-500/20 text-warning-400 border border-warning-500/50 px-4 py-2 rounded font-semibold hover:bg-warning-500/30 transition-all duration-200 text-sm"
        >
          {{ showHint ? "Hide" : "" }}Hint
        </button>
        <button
          (click)="clearCurrentAnswer()"
          class="px-4 py-2 bg-dark-600 text-gray-300 rounded font-semibold hover:bg-dark-500 hover:text-white transition-all duration-200 text-sm"
        >
          Clear
        </button>
      </div>

      <!-- Hint Panel -->
      <div
        *ngIf="showHint"
        class="bg-warning-500/10 border border-warning-500/30 rounded p-3 mb-3"
      >
        <div class="flex items-center justify-between mb-1.5">
          <h3 class="font-semibold text-warning-400 text-xs">
            Hint L{{ hintLevel }}:
          </h3>
          <div class="flex gap-1.5">
            <button
              (click)="decreaseHintLevel()"
              [disabled]="hintLevel === 1"
              class="px-2 py-1 bg-warning-500/20 text-warning-400 rounded text-xs hover:bg-warning-500/30 disabled:opacity-50 disabled:cursor-not-allowed transition-colors"
            >
              -
            </button>
            <button
              (click)="increaseHintLevel()"
              [disabled]="hintLevel === 3"
              class="px-2 py-1 bg-warning-500/20 text-warning-400 rounded text-xs hover:bg-warning-500/30 disabled:opacity-50 disabled:cursor-not-allowed transition-colors"
            >
              +
            </button>
          </div>
        </div>
        <p class="text-white text-sm font-mono">{{ getHint() }}</p>
      </div>
    </div>

    <!-- Navigation Buttons -->
    <div class="flex gap-2 mb-3">
      <button
        (click)="previousQuestion()"
        [disabled]="isFirstQuestion"
        class="flex-1 bg-dark-700 text-gray-300 px-4 py-2 rounded font-semibold hover:bg-dark-600 hover:text-white disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-200 text-sm"
      >
        ← Prev
      </button>

      <button
        *ngIf="!isLastQuestion"
        (click)="nextQuestion()"
        class="flex-1 bg-accent-cyan/20 text-accent-cyan border border-accent-cyan/50 px-4 py-2 rounded font-semibold hover:bg-accent-cyan/30 transition-all duration-200 text-sm"
      >
        Next →
      </button>

      <button
        *ngIf="isLastQuestion"
        (click)="confirmSubmitQuiz()"
        [disabled]="isSubmitting"
        class="flex-1 bg-gradient-to-r from-success-500 to-success-600 text-white px-4 py-2 rounded font-semibold hover:shadow-lg disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-200 text-sm"
      >
        {{ isSubmitting ? "Submitting..." : "Submit" }}
      </button>
    </div>

    <!-- Question Navigator -->
    <div
      class="bg-dark-800/80 backdrop-blur-lg shadow-card-dark rounded-lg border border-dark-600/50 p-3 mb-3"
    >
      <h3 class="font-semibold text-white mb-2 text-sm">Jump to:</h3>
      <div class="grid grid-cols-10 gap-1.5">
        <button
          *ngFor="let question of questions; let i = index"
          (click)="goToQuestion(i)"
          [ngClass]="{
            'bg-gradient-to-r from-accent-cyan to-accent-purple text-white':
              i === currentQuestionIndex,
            'bg-success-500/20 text-success-400 border-success-500/50':
              i !== currentQuestionIndex && isQuestionAnswered(i),
            'bg-dark-700 text-gray-400 border-dark-600':
              i !== currentQuestionIndex && !isQuestionAnswered(i)
          }"
          class="aspect-square rounded font-semibold border hover:scale-105 transition-all duration-200 text-xs"
        >
          {{ i + 1 }}
        </button>
      </div>
    </div>

    <!-- Exit Button -->
    <div class="text-center">
      <button
        (click)="exitQuiz()"
        class="text-error-400 hover:text-error-300 font-medium transition-colors text-xs"
      >
        Exit Quiz
      </button>
    </div>
  </div>
</div>
